# ========================================
# SERVICE CONFIGURATION
# ========================================
quarkus.http.port=8080
%dev.quarkus.http.port=8082

# ========================================
# DATABASE - MONGODB
# ========================================
%prod.quarkus.mongodb.connection-string=${QUARKUS_MONGODB_CONNECTION_STRING}
quarkus.mongodb.database=${QUARKUS_MONGODB_DATABASE:productdb}

# Connection pool
quarkus.mongodb.max-pool-size=50
quarkus.mongodb.min-pool-size=10

# ========================================
# CACHE - REDIS
# ========================================
%prod.quarkus.redis.hosts=${QUARKUS_REDIS_HOSTS}
quarkus.redis.client-type=standalone

# Redis Cache Configuration
quarkus.cache.type=redis

# Cache-specific TTL
quarkus.cache.redis.products-cache.ttl=5m
quarkus.cache.redis.product-by-id.ttl=10m
quarkus.cache.redis.products-by-category.ttl=5m
quarkus.cache.redis.products-active.ttl=5m

# ========================================
# KAFKA
# ========================================
%prod.quarkus.kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:kafka:9093}
# quarkus.kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9093}  # Overridden by Dev Services

# Dev Services (enabled for local development)
%dev.quarkus.mongodb.devservices.enabled=true
%dev.quarkus.redis.devservices.enabled=true
%dev.quarkus.kafka.devservices.enabled=true

# ========================================
# KAFKA PRODUCERS
# ========================================
# Producer - Product Created
mp.messaging.outgoing.product-created.connector=smallrye-kafka
mp.messaging.outgoing.product-created.topic=product-created
mp.messaging.outgoing.product-created.value.serializer=io.quarkus.kafka.client.serialization.ObjectMapperSerializer
mp.messaging.outgoing.product-created.acks=1
mp.messaging.outgoing.product-created.retries=3
mp.messaging.outgoing.product-created.retry-backoff-max-delay=10000

# Producer - Product Updated
mp.messaging.outgoing.product-updated.connector=smallrye-kafka
mp.messaging.outgoing.product-updated.topic=product-updated
mp.messaging.outgoing.product-updated.value.serializer=io.quarkus.kafka.client.serialization.ObjectMapperSerializer
mp.messaging.outgoing.product-updated.acks=1
mp.messaging.outgoing.product-updated.retries=3
mp.messaging.outgoing.product-updated.retry-backoff-max-delay=10000

# Producer - Product Deleted
mp.messaging.outgoing.product-deleted.connector=smallrye-kafka
mp.messaging.outgoing.product-deleted.topic=product-deleted
mp.messaging.outgoing.product-deleted.value.serializer=io.quarkus.kafka.client.serialization.ObjectMapperSerializer
mp.messaging.outgoing.product-deleted.acks=1
mp.messaging.outgoing.product-deleted.retries=3
mp.messaging.outgoing.product-deleted.retry-backoff-max-delay=10000

# Producer - Stock Changed
mp.messaging.outgoing.stock-changed.connector=smallrye-kafka
mp.messaging.outgoing.stock-changed.topic=stock-changed
mp.messaging.outgoing.stock-changed.value.serializer=io.quarkus.kafka.client.serialization.ObjectMapperSerializer
mp.messaging.outgoing.stock-changed.acks=1
mp.messaging.outgoing.stock-changed.retries=3
mp.messaging.outgoing.stock-changed.retry-backoff-max-delay=10000

# ========================================
# KAFKA CONSUMERS
# ========================================
# Consumer - Order Created
mp.messaging.incoming.order-created.connector=smallrye-kafka
mp.messaging.incoming.order-created.topic=order-created
mp.messaging.incoming.order-created.group.id=product-service
mp.messaging.incoming.order-created.auto.offset.reset=earliest
mp.messaging.incoming.order-created.enable.auto.commit=true
mp.messaging.incoming.order-created.failure-strategy=ignore

# ========================================
# OBSERVABILITY
# ========================================
# Health Check
quarkus.smallrye-health.root-path=/q/health

# Metrics
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/q/metrics

# ========================================
# LOGGING
# ========================================
quarkus.log.level=INFO
quarkus.log.category."com.ecommerce".level=DEBUG
quarkus.log.console.format=%d{HH:mm:ss} %-5p [%c{2.}] (%t) %s%e%n

# ========================================
# PROFILE: DEV
# ========================================
#%dev.quarkus.console.enabled=false

# ========================================
# PROFILE: PRODUCTION
# ========================================
%prod.quarkus.log.level=INFO
%prod.quarkus.log.category."com.ecommerce".level=INFO